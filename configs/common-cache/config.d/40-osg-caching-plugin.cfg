#
# Configure XRootD Caching Proxy (`XCache`) for OSG deploys.
#
# **********************************************************************
# * WARNING: DO NOT EDIT THIS FILE.  IT WILL BE OVERWRITTEN ON UPGRADE *
# **********************************************************************
#
# This file is part of the XCache Daemon

# Load the correct libraries for XCache to operate:
# First, the proxy library itself.
ofs.osslib  libXrdPss.so
# Second, the cache underlying the proxy.
pss.cachelib libXrdFileCache.so

if named atlas-xcache
   pss.origin =

   # Load the Rucio namespace-mapping plugin
   pss.namelib -lfncache /usr/lib64/XrdName2NameDCP4RUCIO.so

   # Specifies the names of oss.space name for data and the oss.space name for metadata
   pfc.spaces data meta
else
   pss.origin redirector.osgstorage.org:1094

   # Tune the client timeouts to more aggressively timeout.
   pss.setopt ParallelEvtLoop 10
   pss.setopt RequestTimeout 25
   pss.setopt ConnectTimeout 25
   pss.setopt ConnectionRetry 2
fi

# Cache plugin parameters
#
# These values should be sufficient for most use cases. To change them, override them
# in a later file such as 90-local.cfg.

if defined ?~XC_RAMSIZE
   set eBLOCKSIZE=$XC_BLOCKSIZE
else
   set eBLOCKSIZE=512k
fi

if defined ?~XC_RAMSIZE
   set ePREFETCH=$XC_PREFETCH
else
   set ePREFETCH=10
fi

if defined ?~XC_RAMSIZE
   set eRAMSIZE=$XC_RAMSIZE
else
   set eRAMSIZE=1g
fi

if defined ?~XC_RAMSIZE
   set eSPACELOWWM=$XC_SPACE_LOW_WM
else
   set eSPACELOWWM=0.90
fi

if defined ?~XC_RAMSIZE
   set eSPACEHIGHWM=$XC_SPACE_HIGH_WM
else
   set eSPACEHIGHWM=0.95
fi

# The size of the blocks in cache; all reads to the data federation
# will be rounded along these boundaries.
pfc.blocksize $eBLOCKSIZE
# Amount of memory to use for blocks in flight; this is NOT a RAM cache,
# just a temporary buffer.
# 1GB is 200 files concurrently downloaded with 10 prefetch blocks.
pfc.ram $eRAMSIZE
# Number of blocks to prefetch from a file at once.
pfc.prefetch $ePREFETCH
# The low-water and high-water marks for the disk usage; once disk usage
# goes above the high-water mark, the cache deletes until it hits the low-water
# mark.
pfc.diskusage $eSPACELOWWM $eSPACEHIGHWM


